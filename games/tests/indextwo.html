<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Maze ‚Äî A* Worker, Smooth Movement, Animations (with BFS & Debug)</title>
  <link rel="stylesheet" href="./maze.css" />
  <style>
    /* debug overlay styles (Option A - top-left) */
    #debugOverlay {
      position: fixed;
      top: 8px;
      left: 8px;
      background: rgba(12, 12, 12, 0.72);
      color: #e8eef2;
      padding: 8px 10px;
      border-radius: 8px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
      font-size: 12px;
      line-height: 1.25;
      z-index: 9999;
      pointer-events: none;
      display: none; /* toggled with ~ */
      min-width: 180px;
    }
    #debugOverlay b { color: #fff; }
    #controls .hint-group { display:inline-flex; gap:.4rem; align-items:center; }
  </style>
</head>
<body>
  <header id="top">
    <div id="controls">
      <label>
        W
        <input id="widthIn" type="number" value="21" min="7" step="2" inputmode="numeric">
      </label>
      <label>
        H
        <input id="heightIn" type="number" value="21" min="7" step="2" inputmode="numeric">
      </label>

      <label for="difficulty">Difficulty</label>
      <select id="difficulty" name="difficulty">
        <option value="easy">Easy</option>
        <option value="normal" selected>Normal</option>
        <option value="hard">Hard</option>
        <option value="cruel">Cruel</option>
      </select>

      <button id="regen" type="button">Regenerate</button>
      <button id="reset" type="button">Reset</button>
      <button id="undo" type="button" disabled>Undo</button>

      <label class="inline">
        <input id="rev" type="checkbox">
        Unlock üîô Travel
      </label>

      <div class="hint-group">
        <button id="hint" type="button">Hint (A*)</button>
        <button id="hintDead" type="button" title="Find path to nearest dead-end">Hint (Dead-end)</button>
      </div>

      <button id="coachBtn" type="button">How</button>

      <small class="note">
        Tip: hold arrow keys or hold pointer to continuously move.
      </small>
    </div>
  </header>

  <main id="wrap">
    <canvas id="canvas" aria-label="Maze game"></canvas>
  </main>

  <footer id="hud" aria-live="polite">
    <div class="muted">Progress: <span id="progress">0%</span></div>
    <div class="muted">Time: <span id="timer">00:00</span></div>
    <div class="muted">Score: <span id="score">0</span></div>
    <div class="muted">Highscore: <span id="highscore">0</span></div>
  </footer>

  <dialog id="coachDialog" aria-labelledby="coachTitle">
    <form method="dialog">
      <h3 id="coachTitle">How to play</h3>
      <p>
        Goal: fill all path cells into walls (intentionally "ruin the maze").
        If ‚ÄúUnlock üîô Travel‚Äù is unchecked, the cell you leave becomes a wall ‚Äî
        plan routes to collect dead-end bonuses. Reach the end for a finish
        bonus reduced by your elapsed time.
      </p>
      <ul>
        <li>Use arrows or swipe/hold pointer for continuous movement.</li>
        <li>Dead-end cells give bonus points and spawn a little particle flourish + sound.</li>
        <li>Undo restores the last move/fill (limited stack), hint runs A* in a worker, dead-end hint uses BFS in a separate worker.</li>
      </ul>
      <menu>
        <button id="closeCoach" value="close" type="submit">Close</button>
      </menu>
    </form>
  </dialog>

  <!-- debug overlay -->
  <div id="debugOverlay" aria-hidden="true">
    <div><b>FPS</b>: <span id="dbgFps">0</span></div>
    <div><b>Dirty</b>: <span id="dbgDirty">0</span></div>
    <div><b>Particles</b>: <span id="dbgParticles">0</span></div>
    <div><b>Anims</b>: <span id="dbgAnims">0</span></div>
    <div><b>Player</b>: <span id="dbgPlayer">0,0</span></div>
    <div><b>Paths</b>: <span id="dbgPaths">0 / 0</span></div>
    <div><b>A*</b>: <span id="dbgAstar">idle</span> <b>BFS</b>: <span id="dbgBfs">idle</span></div>
  </div>

  <script type="module" src="./maze.js"></script>
</body>
</html>
